#!/usr/bin/env bash

# shellcheck disable=SC1091

# ensure the command is run in a git repo
source __assertgitrepo

function main() {

    __assertgitrepo

    numUnstagedFiles=$(git status --short | grep "^.[A-Z?] " -c)
    if [[ $numUnstagedFiles -eq 0 ]]; then
        gstatus
        printf "\n[INFO] No unstaged files.\n"
        return
    fi

    git status --short | grep "^.[A-Z?] " | fzf -m --color 'fg:160' | sed -e 's/...//' | xargs git add
    # TODO: check status of this command here (fzf, xargs or git add might fail)

    gstatus
}

if [[ $# -eq 0 ]]; then
    main
elif [[ $# -eq 1 && "$*" == "." ]]; then
    git add -A
    gstatus
else
    echo "[ERROR] Only \".\" is accepted as a valid input to gadd"
fi
